package com.duck.playduck.member.controller;

import java.io.UnsupportedEncodingException;
import java.util.Random;

import javax.mail.MessagingException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.mail.javamail.JavaMailSenderImpl;
import org.springframework.stereotype.Service;

@Service("mss")
public class MailSendService {
	private int size;
	
    @Autowired
    private JavaMailSenderImpl mailSender;

    //인증키 생성
    private String getKey(int size) {
        this.size = size;
        return getAuthCode();
    }

    //인증코드 난수 발생
    private String getAuthCode() {
        Random random = new Random();
        StringBuffer buffer = new StringBuffer();
        int num = 0;

        while(buffer.length() < size) {
            num = random.nextInt(10);
            buffer.append(num);
        }

        return buffer.toString();
    }

    //인증메일 보내기
    public String sendAuthMail(String email) {
        //6자리 난수 인증번호 생성
        String authKey = getKey(6);

        //인증메일 보내기
        try {
            MailUtils sendMail = new MailUtils(mailSender);
            sendMail.setSubject("[PLAYDUCK] 회원가입 이메일 인증");
            sendMail.setText(new StringBuffer().append("<h1> [PLAYDUCK] 이메일 인증</h1>")
            .append("<img src='data:image/jpeg;base64,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'/>")
            .append("<p>아래 링크를 클릭하시면 이메일 인증이 완료됩니다.</p>")
            .append("<a href='http://localhost:8088/playduck/member/signUpConfirm.do?m_email=")
            .append(email)
            .append("&m_status=")
            .append(authKey)
            .append("' target='_blenk'>이메일 인증 확인</a>")
            .toString());
            sendMail.setFrom("guswhddlf11@gmail.com", "[PLAYDUCK]");
            sendMail.setTo(email);
            sendMail.send();
        } catch (MessagingException e) {
            e.printStackTrace();
        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }

          return authKey;
    }
}