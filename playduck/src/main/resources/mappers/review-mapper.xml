<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review-mapper">

	<insert id="insertReview" parameterType="map">
		insert into review values(seq_r_no.nextval, #{p_no}, #{m_no}, #{r_content}, default, default, #{r_status})
	</insert>

	<insert id="insertReview2" parameterType="map">
		insert into playdetail values(seq_pd_no.nextval, 'PF175502', #{pd_theater}, #{pd_story}, #{pd_producing}, #{pd_casting})
	</insert>
	
	<select id="selectCount" resultType="_int" parameterType="Member">
		SELECT COUNT(R_NO)
		FROM REVIEW
		WHERE M_NO = #{ m_no }
	</select>
	
	<select id="selectGood" resultType="HashMap" parameterType="review">
	SELECT '1', R.*, M.* FROM REVIEW R
JOIN MEMBER M ON(R.M_NO = M.M_NO)
WHERE P_NO = #{p_no} AND R_STATUS = '1' and R.m_no = #{m_no}
union
SELECT '2', R.*, M.* FROM REVIEW R
JOIN MEMBER M ON(R.M_NO = M.M_NO)
WHERE P_NO = #{p_no} AND R_STATUS = '1' and R.m_no != #{m_no}
	</select>
	
	<select id="selectBad" resultType="HashMap" parameterType="review">
	SELECT '1', R.*, M.* FROM REVIEW R
JOIN MEMBER M ON(R.M_NO = M.M_NO)
WHERE P_NO = #{p_no} AND R_STATUS = '2' and R.m_no = #{m_no}
union
SELECT '2', R.*, M.* FROM REVIEW R
JOIN MEMBER M ON(R.M_NO = M.M_NO)
WHERE P_NO = #{p_no} AND R_STATUS = '2' and R.m_no != #{m_no}
	</select>
	
	<delete id="deleteReview">
  		delete from review where r_no = #{r_no}
 	</delete>
	<select id="myReview" resultType="Review" parameterType="_int">
		SELECT P_NO
		FROM REVIEW
		WHERE M_NO = #{ m_no }
	</select>
	
	<select id="reviewDupl" resultType="_int" parameterType="hashmap">
	SELECT COUNT(*) count FROM REVIEW 
WHERE M_NO = #{m_no} AND P_NO = #{p_no}
	</select>
	
	<insert id="likeInsert" parameterType="map">
		insert into rlike values(seq_l_no.nextval, #{p_no}, #{r_no}, 1)
	</insert>
	
	<update id="likeInsert2">
	UPDATE REVIEW
		SET R_GOOD = R_GOOD + 1
		WHERE R_NO = #{ r_no } 
	</update>
	
	<select id="likeCount" resultType="_int" parameterType="hashmap">
	SELECT COUNT(*) count FROM REVIEW 
WHERE M_NO = #{m_no} AND R_NO = #{r_no} AND RL_STATUS = 1
	</select>
	
</mapper>